# Техническое задание на разработку прототипа платформы "Kindred"
## (с интеграцией децентрализованных контрактов)

**Версия:** 2.0
**Статус:** Прототип (MVP)

---

## 1. Общие сведения

### 1.1. Наименование проекта
**Kindred** — платформа для осознанного совместного родительства с децентрализованной системой юридических контрактов.

### 1.2. Концепция и инновации
Платформа совмещает:
1. **Медиаторскую платформу** для подбора совместимых партнеров для совместного родительства
2. **Юридический протокол** для создания, хранения и верификации контрактов в децентрализованной сети (TON Blockchain + IPFS/TON Storage)
3. **Telegram Mini App** как основной интерфейс для удобства пользователей

### 1.3. Цели прототипа (MVP)
1. Демонстрация полного цикла: подбор → общение → согласование → контракт
2. Тестирование децентрализованной архитектуры контрактов
3. Сбор обратной связи по UX/UI в Telegram-интерфейсе
4. Подготовка к масштабированию и привлечению инвестиций

---

## 2. Архитектурная концепция

### 2.1. Основные компоненты

┌─────────────────────────────────────────────────────────────┐ │                    Telegram Mini App (TMA)                  │ │  -  Аутентификация через TON Connect                         │ │  -  Интерфейсы: профиль, поиск, чат, контракты, верификация │ └──────────────┬──────────────────────────────────────────────┘ │ ┌──────────────▼──────────────────────────────────────────────┐ │                   Backend API (централизованный)            │ │  -  Бизнес-логика платформы                                  │ │  -  Хранение пользовательских данных (без контрактов)       │ │  -  Посредник между TMA и блокчейном                        │ └──────────────┬──────────────────────────────────────────────┘ │ ┌──────────────▼──────────────────────────────────────────────┐ │               Децентрализованная инфраструктура             │ │  -  TON Blockchain (смарт-контракты, хэши)                  │ │  -  IPFS/TON Storage (хранение контрактов в JSON формате)   │ └─────────────────────────────────────────────────────────────┘

### 2.2. Формат контрактов
**Канонизированный JSON** — основной формат хранения контрактов:
- Все договоры структурированы по единой JSON-схеме
- Автоматическая канонизация (сортировка ключей, удаление лишних пробелов)
- Хэширование канонизированной строки через SHA-256
- Хранение JSON-файла в IPFS/TON Storage
- Хранение хэша в TON Blockchain

---

## 3. Функциональные требования

### 3.1. Модуль регистрации и верификации

#### 3.1.1. Аутентификация через TON Connect
- Интеграция TON Connect 2.0 в Telegram Mini App
- Авторизация по TON кошельку (вместо email/пароля)
- Получение публичного адреса кошелька для идентификации

#### 3.1.2. Базовый KYC (Know Your Customer)
- Загрузка фото лица через TMA
- Верификация номера Telegram
- Для мужчин: подтверждение доходов (через загруженные документы)

### 3.2. Модуль профиля и подбора

#### 3.2.1. Алгоритм подбора
- Географическая близость (30%)
- Совпадение ценностей воспитания (40%)
- Финансовые условия (20%)
- Дополнительные параметры (10%)

#### 3.2.2. Лента и фильтры
- Адаптированный под мобильный интерфейс дизайн
- Swipe-механика (вправо — интересно, влево — пропустить)

### 3.3. Модуль общения
- Безопасный текстовый чат внутри TMA
- Модерация сообщений (автоматическая фильтрация)
- Возможность отправки медиа (с ограничениями)

### 3.4. Модуль децентрализованных контрактов

#### 3.4.1. Создание контракта
1. **Инициатор** заполняет форму (условия, финансы, права).
2. Форма валидируется по JSON-схеме.
3. Генерируется превью.

#### 3.4.2. Согласование
1. Контракт отправляется **Контрагенту**.
2. Контрагент нажимает "Согласен".

#### 3.4.3. Финализация в блокчейне
После согласия обеих сторон:
1. JSON канонизируется и хэшируется (SHA-256).
2. Файл загружается в IPFS/TON Storage.
3. Инициатор подписывает транзакцию через кошелек.
4. Хэш и ссылка записываются в смарт-контракт в TON.

#### 3.4.4. Верификация
Любой может проверить подлинность, загрузив файл. Система сравнит его хэш с тем, что в блокчейне.

---

## 4. Технический стек

### 4.1. Фронтенд (Telegram Mini App)
- **Фреймворк:** React + TypeScript (Vite)
- **Стили:** Tailwind CSS
- **TON:** TON Connect UI React
- **Роутинг:** React Router DOM
- **Состояние:** Zustand
- **Валидация:** Zod

### 4.2. Backend
- **Язык:** Node.js (Express)
- **База данных:** PostgreSQL (данные юзеров)
- **Кеш:** Redis
- **TON SDK:** @ton/ton
- **Storage:** IPFS Client

### 4.3. Блокчейн
- **Язык:** Tact (предпочтительно) или FunC
- **Сеть:** TON Testnet

---

## 5. JSON-схема контракта (Пример структуры)

{ “metadata”: { “contractId”: “kindred-2023-001”, “createdAt”: “2023-10-20T12:00:00Z”, “version”: “1.0” }, “parties”: { “initiator”: { “tonAddress”: “…”, “telegramId”: “…” }, “counterparty”: { “tonAddress”: “…”, “telegramId”: “…” } }, “terms”: { “financial”: { “monthlyPayment”: 2000, “currency”: “USD” } }, “signatures”: { “initiatorAgreedAt”: “…”, “counterpartyAgreedAt”: “…” } }
